<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Malware analysis report: WinDealer (LuoYu Threat Group) - MSSP Lab</title>
<meta name="description" content="WinDealer is a type of malware that is used for financial fraud and theft. It is a banking Trojan that is designed to steal sensitive financial information, such as login credentials, credit card numbers, and other personal information from victims’ computers.">


  <meta name="author" content="MSSP Lab">
  
  <meta property="article:author" content="MSSP Lab">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="MSSP Lab">
<meta property="og:title" content="Malware analysis report: WinDealer (LuoYu Threat Group)">
<meta property="og:url" content="http://localhost:4000/threat-hunting/2023/05/08/malware-analysis-windealer.html">


  <meta property="og:description" content="WinDealer is a type of malware that is used for financial fraud and theft. It is a banking Trojan that is designed to steal sensitive financial information, such as login credentials, credit card numbers, and other personal information from victims’ computers.">



  <meta property="og:image" content="http://localhost:4000/assets/images/2/2023-05-08_12-08.png">



  <meta name="twitter:site" content="@MSSP Lab">
  <meta name="twitter:title" content="Malware analysis report: WinDealer (LuoYu Threat Group)">
  <meta name="twitter:description" content="WinDealer is a type of malware that is used for financial fraud and theft. It is a banking Trojan that is designed to steal sensitive financial information, such as login credentials, credit card numbers, and other personal information from victims’ computers.">
  <meta name="twitter:url" content="http://localhost:4000/threat-hunting/2023/05/08/malware-analysis-windealer.html">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/assets/images/2/2023-05-08_12-08.png">
    
  

  



  <meta property="article:published_time" content="2023-05-08T05:00:00+03:00">





  

  


<link rel="canonical" href="http://localhost:4000/threat-hunting/2023/05/08/malware-analysis-windealer.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "MSSP Lab",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="MSSP Lab Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          MSSP Lab
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">about</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/assets/images/mssp-logo-white.png" alt="MSSP Lab" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">MSSP Lab</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>cybersec lab. research and development</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="mailto:mssplab.uae@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/MSSPLab" rel="nofollow noopener noreferrer me"><i class="fab fa-twitter" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/MSSPLab/" rel="nofollow noopener noreferrer me"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/company/mssp-lab/" rel="nofollow noopener noreferrer me"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Malware analysis report: WinDealer (LuoYu Threat Group)">
    <meta itemprop="description" content="WinDealer is a type of malware that is used for financial fraud and theft. It is a banking Trojan that is designed to steal sensitive financial information, such as login credentials, credit card numbers, and other personal information from victims’ computers.">
    <meta itemprop="datePublished" content="2023-05-08T05:00:00+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/threat-hunting/2023/05/08/malware-analysis-windealer.html" class="u-url" itemprop="url">Malware analysis report: WinDealer (LuoYu Threat Group)
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <p>WinDealer is a type of malware that is used for financial fraud and theft. It is a banking Trojan that is designed to steal sensitive financial information, such as login credentials, credit card numbers, and other personal information from victims’ computers.</p>

<p><img src="/assets/images/2/2023-05-08_12-08.png" alt="windealer" class="img-responsive" /></p>

<p>Following are the capabilities of the malware:</p>
<ul>
  <li>Manipulation of files and file systems: reading, writing, and deleting files, listing directories, and collecting disk information</li>
  <li>Information collection: gathering device details, network settings, and/or keyboard layout, listing running processes, installed software, and configuration files of popular messaging services (Skype, QQ, WeChat, and Wangwang);</li>
  <li>Download and upload random file types; arbitrarily executed commands;</li>
  <li>System-wide text file and Microsoft Word document search;</li>
  <li>Screenshot taking;</li>
  <li>Discovery of networks through ping scan;</li>
  <li>Backdoor maintenance: enabling or disabling persistence (through the RUN key in the registry) and configuration changes</li>
</ul>

<h3 id="threat-actor">Threat actor</h3>

<p>LuoYu is a threat group that is believed to be a Chinese state-sponsored hacking group. The group has been active since at least 2011 and is known to target a wide range of industries, including defense, government, telecommunications, and technology.</p>

<h3 id="target">Target</h3>

<p><em>Geographies and sectors</em>:</p>

<ul>
  <li>Chinese subsidiaries of Japanese companies</li>
  <li>Users of a Chinese private bank</li>
</ul>

<p><em>Industry</em>:</p>

<ul>
  <li>Technology</li>
  <li>Media</li>
  <li>Financial</li>
  <li>Military</li>
  <li>Telecom</li>
  <li>Ministries of Foreign Affairs</li>
</ul>

<h3 id="cyber-kill-chain">Cyber Kill Chain</h3>

<p>WinDealer steals information of an infected <code class="language-plaintext highlighter-rouge">PC</code> and sends it to a <code class="language-plaintext highlighter-rouge">C2</code> server as described in here:</p>

<p><img src="/assets/images/2/2023-03-30_21-53.png" alt="ckc" /></p>

<hr />

<h3 id="identification">Identification</h3>

<p>Two samples are being investigated:</p>

<p><em>sample.exe</em>:</p>

<p>File size: <code class="language-plaintext highlighter-rouge">372736 bytes</code>  <br />
MD5 sum: <code class="language-plaintext highlighter-rouge">cc7207f09a6fe41c71626ad4d3f127ce</code>   <br />
SHA-1 sum: <code class="language-plaintext highlighter-rouge">84e749c37978f9387e16fab29c7b1b291be93a63</code>  <br />
SHA-256 sum: <code class="language-plaintext highlighter-rouge">28df5c75a2f78120ff96d4a72a3c23cee97c9b46c96410cf591af38cb4aed0fa</code></p>

<p>First of all, check our sample via VirusTotal:</p>

<p><a href="https://www.virustotal.com/gui/file/28df5c75a2f78120ff96d4a72a3c23cee97c9b46c96410cf591af38cb4aed0fa/details">https://www.virustotal.com/gui/file/28df5c75a2f78120ff96d4a72a3c23cee97c9b46c96410cf591af38cb4aed0fa/details</a></p>

<p><img src="/assets/images/2/2023-03-29_14-16.png" alt="vt" /></p>

<p><strong>So, 52 of 68 AV engines detect our sample as malicious.</strong></p>

<p><img src="/assets/images/2/2023-03-29_14-18.png" alt="vt" /></p>

<p>More of them detect file as <code class="language-plaintext highlighter-rouge">Backdoor.Win32.WINDEALER.ZYJA</code>.</p>

<h3 id="static-analysis">Static analysis</h3>

<p>The specified sample is a PE file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file &lt;sample.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-29_14-13.png" alt="file" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hexdump <span class="nt">-C</span> &lt;sample.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-29_14-14.png" alt="file" /></p>

<p>Use <code class="language-plaintext highlighter-rouge">exiftool</code> for looking metadata:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool &lt;sample.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-30_11-09.png" alt="file" /></p>

<p>And we see that file timestamp is <code class="language-plaintext highlighter-rouge">2021-01-25 13:32:26+03.00</code></p>

<p>Executable sample is not packed by <code class="language-plaintext highlighter-rouge">upx</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>upx <span class="nt">-l</span> &lt;sample.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-30_11-11.png" alt="upx" /></p>

<p>What about Shannon entropy of the sample:</p>

<p><img src="/assets/images/2/2023-03-29_14-15.png" alt="shannon" /></p>

<p>Analysze with DIE says that the compiler is <code class="language-plaintext highlighter-rouge">Microsoft Visual Studio C++ (6.0)</code>:</p>

<p><img src="/assets/images/2/2023-03-29_14-19.png" alt="die" /></p>

<p><img src="/assets/images/2/2023-03-29_14-20.png" alt="die" /></p>

<p>Malware contains encrypted DLL:</p>

<p><img src="/assets/images/2/2023-03-29_14-22.png" alt="die" /></p>

<p>Interesting strings:</p>

<p><img src="/assets/images/2/2023-03-30_11-30.png" alt="strings" /></p>

<p>The hardcoded version of WinDealer:</p>

<p><img src="/assets/images/2/2023-03-30_11-34.png" alt="version" /></p>

<p><code class="language-plaintext highlighter-rouge">18.20.1225</code> - version: <code class="language-plaintext highlighter-rouge">18</code>, year: <code class="language-plaintext highlighter-rouge">2020</code>, month and day: <code class="language-plaintext highlighter-rouge">12.25</code></p>

<p>another intersting strings is:</p>

<p><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Control\Network\{4D36E972-E325-11CE-BFC1-08002BE10318}\%s\Connection</code>:</p>

<p><img src="/assets/images/2/2023-03-30_11-43.png" alt="string" /></p>

<h3 id="dynamic-analysis">Dynamic analysis</h3>

<p>The sample is GUI application:</p>

<p><img src="/assets/images/2/2023-03-30_12-38.png" alt="winmain" /></p>

<p>Contacted IP addresses is:</p>

<p><img src="/assets/images/2/2023-03-30_12-25.png" alt="ip" /></p>

<p>May sleep (evasive loops) to hinder dynamic analysis:</p>

<p><img src="/assets/images/2/2023-03-30_12-32.png" alt="sleep" /></p>

<p><img src="/assets/images/2/2023-03-30_12-45.png" alt="sleep" /></p>

<p>The operator has the power to rename, move, and delete files on the target machine:</p>

<p><img src="/assets/images/2/2023-03-30_12-50.png" alt="createfile" /></p>

<p><img src="/assets/images/2/2023-03-30_12-53.png" alt="createfile" /></p>

<p><img src="/assets/images/2/2023-03-30_12-54.png" alt="delete" /></p>

<p>Also malware search through directories and enum filesystem:</p>

<p><img src="/assets/images/2/2023-03-30_12-48.png" alt="createfile" /></p>

<p>and collecting volume information:</p>

<p><img src="/assets/images/2/2023-03-30_12-53_1.png" alt="vol" /></p>

<h4 id="api-hooking">API hooking</h4>

<p>Using <code class="language-plaintext highlighter-rouge">InterlockedExchange</code>, probably the malware sample is hooking the winapi functions:</p>

<p><img src="/assets/images/2/2023-03-30_13-06.png" alt="interlocked" /></p>

<h4 id="avsandbox-evasion">AV/Sandbox evasion</h4>

<p>In the malware sample above, the delay timeout is set using the <code class="language-plaintext highlighter-rouge">GetTickCount()</code> timer function. The <code class="language-plaintext highlighter-rouge">Sleep()</code> function is called in a loop until the timer timeout. In the sandbox, delays that are performed by the <code class="language-plaintext highlighter-rouge">Sleep()</code> function are skipped (replaced with a very short timeout) and the virtually elapsed time will be much higher than the requested timeout. The concept behind these methods is to measure elapsed time while running several forms of delays in parallel:</p>

<p><img src="/assets/images/2/2023-03-30_13-01.png" alt="timer" /></p>

<hr />

<p><em>sample2.exe</em>:</p>

<p>File size: <code class="language-plaintext highlighter-rouge">458752 bytes</code>  <br />
MD5 sum: <code class="language-plaintext highlighter-rouge">76ba5272a17fdab7521ea21a57d23591</code>   <br />
SHA-1 sum: <code class="language-plaintext highlighter-rouge">6b831413932a394bd9fb25e2bbdc06533821378c</code>  <br />
SHA-256 sum: <code class="language-plaintext highlighter-rouge">ecd001aeb6bcbafb3e2fda74d76eea3c0ddad4e6e7ff1f43cd7709d4b4580261</code></p>

<p>VirusTotal scan result:</p>

<p><a href="https://www.virustotal.com/gui/file/ecd001aeb6bcbafb3e2fda74d76eea3c0ddad4e6e7ff1f43cd7709d4b4580261/detection">https://www.virustotal.com/gui/file/ecd001aeb6bcbafb3e2fda74d76eea3c0ddad4e6e7ff1f43cd7709d4b4580261/detection</a></p>

<p><img src="/assets/images/2/2023-03-30_12-19.png" alt="vt" /></p>

<p><img src="/assets/images/2/2023-03-30_12-20.png" alt="vt" /></p>

<h3 id="static-analysis-1">Static analysis</h3>

<p>The specified sample is a PE file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file &lt;sample2.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-30_12-02.png" alt="img" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hexdump <span class="nt">-C</span> &lt;sample2.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-30_12-03.png" alt="img" /></p>

<p><img src="/assets/images/2/2023-03-30_12-11.png" alt="img" /></p>

<p>Run exiftool for extracting metadata:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool &lt;sample2.exe&gt;
</code></pre></div></div>

<p><img src="/assets/images/2/2023-03-30_12-21.png" alt="img" /></p>

<p>The sample is a Windows GUI file with timestamp: <code class="language-plaintext highlighter-rouge">2021:03:06 04:13:51+03:00</code></p>

<h3 id="dynamic-analysis-1">Dynamic analysis</h3>

<p>Generating victim <code class="language-plaintext highlighter-rouge">ID</code> set in a registry key:</p>

<p><img src="/assets/images/2/2023-03-30_15-54.png" alt="victim" /></p>

<p>The format of the <code class="language-plaintext highlighter-rouge">victim ID</code> is <code class="language-plaintext highlighter-rouge">md5("&lt;MAC address&gt;+&lt;Physical_Drive_info&gt;+&lt;username&gt;")</code>. The malware generates a unique registry entry to store the victim ID for subsequent execution. The <code class="language-plaintext highlighter-rouge">victim ID</code> is not saved as raw data; instead, the malware changes the <code class="language-plaintext highlighter-rouge">4</code> bytes <code class="language-plaintext highlighter-rouge">victim ID</code> to an IP address format.</p>

<p>This sample collecting host information:</p>

<p><img src="/assets/images/2/2023-03-30_13-27.png" alt="host" /></p>

<h4 id="encoding">Encoding</h4>

<p>Malware sample use function call obfuscation:</p>

<p><em><code class="language-plaintext highlighter-rouge">GetUserNameW</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-43.png" alt="username" /></p>

<p><em><code class="language-plaintext highlighter-rouge">RegCreateKeyExA</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-43_1.png" alt="reg" /></p>

<p><em><code class="language-plaintext highlighter-rouge">RegDeleteKeyA</code></em> and <em><code class="language-plaintext highlighter-rouge">RegCloseKey</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-45.png" alt="reg" /></p>

<p><em><code class="language-plaintext highlighter-rouge">RegQueryValueExA</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_16-42.png" alt="reg" /></p>

<p><em><code class="language-plaintext highlighter-rouge">GetTokenInformation</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-41.png" alt="token" /></p>

<p><em><code class="language-plaintext highlighter-rouge">OpenProcessToken</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-40.png" alt="token" /></p>

<p><em><code class="language-plaintext highlighter-rouge">OpenThreadToken</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-39.png" alt="token" /></p>

<p><em><code class="language-plaintext highlighter-rouge">AdjustTokenPrivileges</code></em>:</p>

<p><img src="/assets/images/2/2023-03-30_13-33.png" alt="token" /></p>

<p>.etc.</p>

<p>So, malware sample use one of the interesting classic APT techniques: Token theft via turn on <code class="language-plaintext highlighter-rouge">SeDebugPrivilege</code>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//....</span>
<span class="n">HANDLE</span> <span class="n">token</span><span class="p">;</span>
<span class="n">TOKEN_PRIVILEGES</span> <span class="n">tp</span><span class="p">;</span>
<span class="n">LUID</span> <span class="n">luid</span><span class="p">;</span>
<span class="n">BOOL</span> <span class="n">res</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="n">tp</span><span class="p">.</span><span class="n">PrivilegeCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">tp</span><span class="p">.</span><span class="n">Privileges</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Luid</span> <span class="o">=</span> <span class="n">luid</span><span class="p">;</span>
<span class="n">tp</span><span class="p">.</span><span class="n">Privileges</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Attributes</span> <span class="o">=</span> <span class="n">SE_PRIVILEGE_ENABLED</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">LookupPrivilegeValue</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">luid</span><span class="p">))</span> <span class="n">res</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">OpenProcessToken</span><span class="p">(</span><span class="n">GetCurrentProcess</span><span class="p">(),</span> <span class="n">TOKEN_ADJUST_PRIVILEGES</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">token</span><span class="p">))</span> <span class="n">res</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">AdjustTokenPrivileges</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TOKEN_PRIVILEGES</span><span class="p">),</span> <span class="p">(</span><span class="n">PTOKEN_PRIVILEGES</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="n">PDWORD</span><span class="p">)</span><span class="nb">NULL</span><span class="p">))</span> <span class="n">res</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="c1">//...</span>
</code></pre></div></div>

<h4 id="registry-modifications-and-persistence">Registry Modifications and Persistence</h4>

<p>With a high degree of probability, it can be argued that WinDealer has the functionality of interacting with the registry, probably for persistence mechanism:</p>

<p><img src="/assets/images/2/2023-01-26_19-04.png" alt="reg1" /></p>

<h4 id="encryption">Encryption</h4>

<p>Generate 16 bytes <code class="language-plaintext highlighter-rouge">AES</code> key to encrypt C2 communication:</p>

<p><img src="/assets/images/2/2023-03-30_13-17.png" alt="crypt" /></p>

<p><img src="/assets/images/2/2023-03-30_13-18.png" alt="crypt" /></p>

<h4 id="c2-anti-tracking-mechanism">C2 anti-tracking mechanism</h4>

<p>This malware sample employs an IP Generation Algorithm to generate a random C2 IP address when the backdoor lacks C2 configuration. The IP produced at random will exist inside particular IP address ranges:</p>

<p><code class="language-plaintext highlighter-rouge">113.62.0.0 - 113.63.255.255</code> or   <br />
<code class="language-plaintext highlighter-rouge">111.120.0.0 - 111.123.255.255</code></p>

<p><img src="/assets/images/2/2023-03-30_16-11.png" alt="ip" /></p>

<p>This mechanism will prevent researchers from tracking down the real C2 IP.</p>

<hr />

<p><code class="language-plaintext highlighter-rouge">Backdoor.Win32.WINDEALER.ZYJA</code> is a variant of the <code class="language-plaintext highlighter-rouge">WinDealer</code> malware family. It is a type of backdoor malware that is designed to allow remote attackers to gain unauthorized access to an infected computer system. Once installed, the malware creates a backdoor on the infected system, which allows the attacker to control the system and steal sensitive data.</p>

<p>The <code class="language-plaintext highlighter-rouge">Backdoor.Win32.WINDEALER.ZYJA</code> variant is known to be spread through spear-phishing emails that contain malicious attachments. Once the attachment is opened, the malware is installed and begins to communicate with a remote command-and-control server, allowing the attacker to send commands to the infected system and exfiltrate data.</p>

<p>The malware is capable of performing a range of malicious activities, including stealing credentials and sensitive data, taking screenshots, recording keystrokes, and executing arbitrary commands on the infected system. The malware is also capable of bypassing antivirus and other security software, making it difficult to detect and remove.</p>

<h3 id="iocs">IOCs</h3>

<h4 id="versions">versions</h4>

<table>
  <thead>
    <tr>
      <th>Malware</th>
      <th>version</th>
      <th>md5</th>
      <th>sha1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>WinDealer</td>
      <td>18.20.1225</td>
      <td>76ba5272a17fdab7521ea21a57d23591</td>
      <td>6b831413932a394bd9fb25e2bbdc06533821378c</td>
    </tr>
    <tr>
      <td>WinDealer</td>
      <td>18.20.1225</td>
      <td>cc7207f09a6fe41c71626ad4d3f127ce</td>
      <td>84e749c37978f9387e16fab29c7b1b291be93a63</td>
    </tr>
  </tbody>
</table>

<h4 id="domain-ips">domain IPs</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">113.62.0.0/15 111.120.0.0/14</code></li>
  <li>port <code class="language-plaintext highlighter-rouge">55556/TCP</code>, <code class="language-plaintext highlighter-rouge">6999/UDP</code></li>
  <li><code class="language-plaintext highlighter-rouge">221.195.68.71/32</code></li>
  <li><code class="language-plaintext highlighter-rouge">122.112.245.55/32</code></li>
</ul>

<h3 id="yara-rules-from-malpedia">Yara rules (from Malpedia)</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">rule win_windealer_auto {</span>

    <span class="s">meta</span><span class="pi">:</span>
        <span class="s">author = "Felix Bilstein - yara-signator at cocacoding dot com"</span>
        <span class="s">date = "2023-01-25"</span>
        <span class="s">version = "1"</span>
        <span class="s">description = "Detects win.windealer."</span>
        <span class="s">info = "autogenerated rule brought to you by yara-signator"</span>
        <span class="s">tool = "yara-signator v0.6.0"</span>
        <span class="s">signator_config = "callsandjumps;datarefs;binvalue"</span>
        <span class="s">malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.windealer"</span>
        <span class="s">malpedia_rule_date = "20230124"</span>
        <span class="s">malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"</span>
        <span class="s">malpedia_version = "20230125"</span>
        <span class="s">malpedia_license = "CC BY-SA 4.0"</span>
        <span class="s">malpedia_sharing = "TLP:WHITE"</span>

    <span class="s">/* DISCLAIMER</span>
     <span class="s">* The strings used in this rule have been automatically selected from the</span>
     <span class="s">* disassembly of memory dumps and unpacked files, using YARA-Signator.</span>
     <span class="s">* The code and documentation is published here</span><span class="pi">:</span>
<span class="err">     *</span> <span class="s">https://github.com/fxb-cocacoding/yara-signator</span>
     <span class="s">* As Malpedia is used as data source, please note that for a given</span>
     <span class="s">* number of families, only single samples are documented.</span>
     <span class="s">* This likely impacts the degree of generalization these rules will offer.</span>
     <span class="s">* Take the described generation method also into consideration when you</span>
     <span class="s">* apply the rules in your use cases and assign them confidence levels.</span>
     <span class="s">*/</span>


    <span class="s">strings</span><span class="pi">:</span>
        <span class="s">$sequence_0 = { 668b91d2070000 8a89d0070000 52 51 }</span>
            <span class="s">// n = 4, score = </span><span class="m">800</span>
            <span class="s">//   668b91d2070000       | mov                 dx, word ptr [ecx + 0x7d2]</span>
            <span class="s">//   8a89d0070000         | mov                 cl, byte ptr [ecx + 0x7d0]</span>
            <span class="s">//   52                   | push                edx</span>
            <span class="s">//   51                   | push                ecx</span>

        <span class="s">$sequence_1 = { ff15???????? 85c0 7407 50 ff15???????? 6a01 }</span>
            <span class="s">// n = 6, score = </span><span class="m">800</span>
            <span class="s">//   ff15????????         |</span>                     
            <span class="s">//   85c0                 | test                eax, eax</span>
            <span class="s">//   7407                 | je                  </span><span class="m">9</span>
            <span class="s">//   50                   | push                eax</span>
            <span class="s">//   ff15????????         |</span>                     
            <span class="s">//   6a01                 | push                </span><span class="m">1</span>

        <span class="s">$sequence_2 = { 6a01 50 56 e8???????? 83c410 8bc7 }</span>
            <span class="s">// n = 6, score = </span><span class="m">800</span>
            <span class="s">//   6a01                 | push                </span><span class="m">1</span>
            <span class="s">//   50                   | push                eax</span>
            <span class="s">//   56                   | push                esi</span>
            <span class="s">//   e8????????           |</span>                     
            <span class="s">//   83c410               | add                 esp, 0x10</span>
            <span class="s">//   8bc7                 | mov                 eax, edi</span>

        <span class="s">$sequence_3 = { 6a00 ff15???????? 85c0 7407 50 ff15???????? 6a01 }</span>
            <span class="s">// n = 7, score = </span><span class="m">800</span>
            <span class="s">//   6a00                 | push                </span><span class="m">0</span>
            <span class="s">//   ff15????????         |</span>                     
            <span class="s">//   85c0                 | test                eax, eax</span>
            <span class="s">//   7407                 | je                  </span><span class="m">9</span>
            <span class="s">//   50                   | push                eax</span>
            <span class="s">//   ff15????????         |</span>                     
            <span class="s">//   6a01                 | push                </span><span class="m">1</span>

        <span class="s">$sequence_4 = { 6a04 50 6a04 68???????? 68???????? }</span>
            <span class="s">// n = 5, score = </span><span class="m">800</span>
            <span class="s">//   6a04                 | push                </span><span class="m">4</span>
            <span class="s">//   50                   | push                eax</span>
            <span class="s">//   6a04                 | push                </span><span class="m">4</span>
            <span class="s">//   68????????           |</span>                     
            <span class="s">//   68????????           |</span>                     

        <span class="s">$sequence_5 = { 56 57 68da070000 e8???????? }</span>
            <span class="s">// n = 4, score = </span><span class="m">800</span>
            <span class="s">//   56                   | push                esi</span>
            <span class="s">//   57                   | push                edi</span>
            <span class="s">//   68da070000           | push                0x7da</span>
            <span class="s">//   e8????????           |</span>                     

        <span class="s">$sequence_6 = { 50 56 e8???????? 83c410 8b4618 }</span>
            <span class="s">// n = 5, score = </span><span class="m">800</span>
            <span class="s">//   50                   | push                eax</span>
            <span class="s">//   56                   | push                esi</span>
            <span class="s">//   e8????????           |</span>                     
            <span class="s">//   83c410               | add                 esp, 0x10</span>
            <span class="s">//   8b4618               | mov                 eax, dword ptr [esi + 0x18]</span>

        <span class="s">$sequence_7 = { 8b4d08 668b91d2070000 8a89d0070000 52 51 }</span>
            <span class="s">// n = 5, score = </span><span class="m">800</span>
            <span class="s">//   8b4d08               | mov                 ecx, dword ptr [ebp + 8]</span>
            <span class="s">//   668b91d2070000       | mov                 dx, word ptr [ecx + 0x7d2]</span>
            <span class="s">//   8a89d0070000         | mov                 cl, byte ptr [ecx + 0x7d0]</span>
            <span class="s">//   52                   | push                edx</span>
            <span class="s">//   51                   | push                ecx</span>

        <span class="s">$sequence_8 = { 53 56 57 68da070000 }</span>
            <span class="s">// n = 4, score = </span><span class="m">800</span>
            <span class="s">//   53                   | push                ebx</span>
            <span class="s">//   56                   | push                esi</span>
            <span class="s">//   57                   | push                edi</span>
            <span class="s">//   68da070000           | push                0x7da</span>

        <span class="s">$sequence_9 = { 8b4d08 668b91d2070000 8a89d0070000 52 }</span>
            <span class="s">// n = 4, score = </span><span class="m">800</span>
            <span class="s">//   8b4d08               | mov                 ecx, dword ptr [ebp + 8]</span>
            <span class="s">//   668b91d2070000       | mov                 dx, word ptr [ecx + 0x7d2]</span>
            <span class="s">//   8a89d0070000         | mov                 cl, byte ptr [ecx + 0x7d0]</span>
            <span class="s">//   52                   | push                edx</span>

    <span class="na">condition</span><span class="pi">:</span>
        <span class="s">7 of them and filesize &lt; </span><span class="m">770048</span>
<span class="err">}</span>
</code></pre></div></div>

<p>By Cyber Threat Hunters from MSSPLab:</p>

<ul>
  <li><a href="https://www.linkedin.com/in/zhassulan-zhussupov-5a347419b/">@cocomelonc</a></li>
  <li><a href="https://www.linkedin.com/in/aruzhan-kaldybek-775735226">@wqkasper</a></li>
</ul>

<p>Thanks for your time happy hacking and good bye!       <br />
<em>All drawings and screenshots are MSSPLab’s</em></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#blueteam" class="page__taxonomy-item p-category" rel="tag">blueteam</a><span class="sep">, </span>
    
      <a href="/tags/#malware" class="page__taxonomy-item p-category" rel="tag">malware</a><span class="sep">, </span>
    
      <a href="/tags/#malwareanalysis" class="page__taxonomy-item p-category" rel="tag">malwareanalysis</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#threat-hunting" class="page__taxonomy-item p-category" rel="tag">threat-hunting</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-05-08T05:00:00+03:00">May 8, 2023</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=MSSP+Lab&text=Malware+analysis+report%3A+WinDealer+%28LuoYu+Threat+Group%29%20http%3A%2F%2Flocalhost%3A4000%2Fthreat-hunting%2F2023%2F05%2F08%2Fmalware-analysis-windealer.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fthreat-hunting%2F2023%2F05%2F08%2Fmalware-analysis-windealer.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fthreat-hunting%2F2023%2F05%2F08%2Fmalware-analysis-windealer.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/tutorial/2023/05/07/welcome.html" class="pagination--pager" title="Welcome to our cybersecurity blog
">Previous</a>
    
    
      <a href="/threat-hunting/2023/05/19/malware-src-asyncrat.html" class="pagination--pager" title="Malware source code investigation: AsyncRAT
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/4/APT29.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/threat-hunting/2023/06/02/malware-analysis-apt29.html" rel="permalink">Malware analysis report: SNOWYAMBER (+APT29 related malwares)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This report provides a comprehensive analysis of the SNOWYAMBER dropper, and it’s modifications, a sophisticated piece of malware attributed to the Advanced ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/3/asyncrat.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/threat-hunting/2023/05/19/malware-src-asyncrat.html" rel="permalink">Malware source code investigation: AsyncRAT
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">AsyncRAT is a Remote Access Trojan (RAT) designed to remotely monitor and control infected systems. It is free, open-source, and often used by cybercriminals...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/1/welcome.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/tutorial/2023/05/07/welcome.html" rel="permalink">Welcome to our cybersecurity blog
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Welcome to our cybersecurity blog!

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/MSSPLab" rel="nofollow noopener noreferrer"><i class="fab fa-twitter" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/MSSPLab/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/company/mssp-lab/" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 MSSP Lab. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
